<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>AutoParts - Portal Mayorista</title>
    <link href="{{ url_for('static', filename='css/mayorista.css') }}" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos adicionales para el carrito */
        #cart-items::-webkit-scrollbar {
            width: 5px;
        }
        #cart-items::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        #cart-items::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #cart-items::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">

<!-- Navbar -->
<nav class="bg-blue-900 p-5">
    <div class="max-w-screen-xl mx-auto flex justify-between items-center text-white">
        <a href="{{ url_for('index') }}" class="text-2xl font-bold hover:text-gray-300">AutoParts</a>
        <a href="{{ url_for('login') }}" class="hover:text-gray-300">Cerrar sesión</a>
    </div>
</nav>

<!-- Filtro -->
<section class="max-w-6xl mx-auto px-4 mt-8">
    <label for="filtro" class="block text-lg font-semibold text-gray-700 mb-2">Filtrar por categoría:</label>
    <select id="filtro" class="w-full p-2 rounded-md border border-gray-300">
        <option value="todos">Todos</option>
        <option value="motores">Motores y Componentes</option>
        <option value="frenos">Frenos y Suspensión</option>
        <option value="electricidad">Electricidad y Baterías</option>
        <option value="accesorios">Accesorios y Seguridad</option>
    </select>
</section>

<!-- Contenido -->
<section class="container mx-auto py-10">
    <h2 class="text-center text-3xl font-bold text-gray-800 mb-12">Bienvenido al portal Mayorista</h2>

    <div id="productos" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">

        <!-- Motores -->
        <div class="producto motores bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Filtro+de+Aceite" alt="Filtro de Aceite" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Filtro de Aceite</h3>
                <p class="text-gray-600">Marca: Bosch</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$20.000</p>
                <button onclick="agregarAlCarrito('Filtro de Aceite', 20000, 'prod-001', 'Motores')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <div class="producto motores bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Bujías" alt="Bujías" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Bujías</h3>
                <p class="text-gray-600">Marca: NGK</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$15.200</p>
                <button onclick="agregarAlCarrito('Bujías', 15200, 'prod-002', 'Motores')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <!-- Frenos -->
        <div class="producto frenos bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Pastillas+de+Freno" alt="Pastillas de Freno" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Pastillas de Freno</h3>
                <p class="text-gray-600">Marca: Brembo</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$27.900</p>
                <button onclick="agregarAlCarrito('Pastillas de Freno', 27900, 'prod-003', 'Frenos')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <div class="producto frenos bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Amortiguador" alt="Amortiguador" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Amortiguador</h3>
                <p class="text-gray-600">Marca: Monroe</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$45.500</p>
                <button onclick="agregarAlCarrito('Amortiguador', 45500, 'prod-004', 'Frenos')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <!-- Electricidad -->
        <div class="producto electricidad bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Alternador" alt="Alternador" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Alternador</h3>
                <p class="text-gray-600">Marca: Valeo</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$98.000</p>
                <button onclick="agregarAlCarrito('Alternador', 98000, 'prod-005', 'Electricidad')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <div class="producto electricidad bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Batería" alt="Batería" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Batería</h3>
                <p class="text-gray-600">Marca: Bosch</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$59.900</p>
                <button onclick="agregarAlCarrito('Batería', 59900, 'prod-006', 'Electricidad')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <!-- Accesorios -->
        <div class="producto accesorios bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Kit+de+Emergencia" alt="Kit de emergencia" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Kit de Emergencia</h3>
                <p class="text-gray-600">Marca: SafetyPro</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$12.990</p>
                <button onclick="agregarAlCarrito('Kit de Emergencia', 12990, 'prod-007', 'Accesorios')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

        <div class="producto accesorios bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="https://via.placeholder.com/300x200?text=Cubre+Asientos" alt="Cubre Asientos" class="w-full h-48 object-cover">
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800">Cubre Asientos</h3>
                <p class="text-gray-600">Marca: Autostyle</p>
                <p class="text-gray-900 text-2xl font-bold mt-2">$18.000</p>
                <button onclick="agregarAlCarrito('Cubre Asientos', 18000, 'prod-008', 'Accesorios')" 
                        class="w-full bg-blue-900 text-white py-2 rounded-lg mt-4 hover:bg-blue-700">
                    Añadir al carrito
                </button>
            </div>
        </div>

    </div>
</section>

<!-- Footer -->
<footer class="bg-blue-900 py-6 text-white text-center">
    <p>&copy; 2025 AutoParts. Todos los derechos reservados.</p>
</footer>

<!-- Carrito Flotante -->
<div class="fixed bottom-10 right-10 z-50">
    <button id="cart-toggle" class="bg-blue-900 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition flex items-center">
        🛒 <span id="cart-count" class="ml-1">0</span>
    </button>
    
    <div id="cart-modal" class="hidden absolute right-0 bottom-full mb-4 w-80 bg-white rounded-lg shadow-xl p-6 border border-gray-200">
        <h3 class="text-xl font-bold mb-4 text-gray-800">Tu Pedido Mayorista</h3>
        <div id="cart-items" class="max-h-60 overflow-y-auto mb-4">
            <p class="text-gray-500 text-center py-4">El carrito está vacío</p>
        </div>
        <div class="border-t pt-4">
            <div class="flex justify-between font-bold text-lg text-gray-800">
                <span>Total:</span>
                <span id="cart-total">$0</span>
            </div>
            <button id="checkout-btn" class="w-full bg-green-600 text-white py-2 rounded-lg mt-4 hover:bg-green-700">
                Finalizar Compra
            </button>
        </div>
    </div>
</div>

<!-- Filtro Script -->
<script>
    const filtro = document.getElementById('filtro');
    const productos = document.querySelectorAll('.producto');

    filtro.addEventListener('change', function () {
        const categoria = this.value;
        productos.forEach(producto => {
            if (categoria === 'todos' || producto.classList.contains(categoria)) {
                producto.classList.remove('hidden');
            } else {
                producto.classList.add('hidden');
            }
        });
    });
</script>

<!-- Carrito Script -->
<script>
    // Carrito unificado para ambas vistas
    const carrito = {
        items: [],
        esMayorista: true, // Esta es la vista mayorista

        agregarProducto: function(nombre, precio, id, categoria) {
            const productoExistente = this.items.find(item => item.id === id && item.esMayorista === this.esMayorista);
            
            if (productoExistente) {
                productoExistente.cantidad++;
            } else {
                this.items.push({
                    id,
                    nombre,
                    precio,
                    categoria,
                    cantidad: 1,
                    esMayorista: this.esMayorista
                });
            }
            this.actualizarUI();
            this.guardarEnLocalStorage();
        },

        actualizarUI: function() {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');
            
            // Actualizar contador
            cartCount.textContent = this.items.reduce((total, item) => total + item.cantidad, 0);
            
            // Actualizar lista de items
            if (this.items.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-4">El carrito está vacío</p>';
                cartTotal.textContent = '$0';
                return;
            }
            
            cartItems.innerHTML = this.items.map(item => `
                <div class="flex justify-between items-center py-2 border-b">
                    <div>
                        <p class="font-medium text-gray-800">${item.nombre}</p>
                        <p class="text-sm text-gray-600">${item.categoria} • ${item.cantidad} × $${item.precio.toLocaleString('es-CL')}</p>
                    </div>
                    <div class="flex items-center">
                        <button class="decrementar px-2 text-red-500 hover:text-red-700" data-id="${item.id}">−</button>
                        <span class="mx-1 text-gray-800">${item.cantidad}</span>
                        <button class="incrementar px-2 text-green-500 hover:text-green-700" data-id="${item.id}">+</button>
                    </div>
                </div>
            `).join('');
            
            // Actualizar total
            const total = this.items.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            cartTotal.textContent = `$${total.toLocaleString('es-CL')}`;
            
            // Agregar event listeners a los botones de cantidad
            document.querySelectorAll('.incrementar').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const item = this.items.find(item => item.id === id);
                    if (item) item.cantidad++;
                    this.actualizarUI();
                    this.guardarEnLocalStorage();
                });
            });
            
            document.querySelectorAll('.decrementar').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const itemIndex = this.items.findIndex(item => item.id === id);
                    if (this.items[itemIndex].cantidad > 1) {
                        this.items[itemIndex].cantidad--;
                    } else {
                        this.items.splice(itemIndex, 1);
                    }
                    this.actualizarUI();
                    this.guardarEnLocalStorage();
                });
            });
        },

        guardarEnLocalStorage: function() {
            localStorage.setItem('carritoAutoParts', JSON.stringify(this.items));
        },

        cargarDesdeLocalStorage: function() {
            const carritoGuardado = localStorage.getItem('carritoAutoParts');
            if (carritoGuardado) {
                this.items = JSON.parse(carritoGuardado);
                // Filtramos solo los items mayoristas para esta vista
                this.items = this.items.filter(item => item.esMayorista);
                this.actualizarUI();
            }
        }
    };

    // Función global para agregar productos
    function agregarAlCarrito(nombre, precio, id, categoria) {
        carrito.agregarProducto(nombre, precio, id, categoria);
    }

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        // Cargar carrito desde localStorage
        carrito.cargarDesdeLocalStorage();
        
        // Configurar botón del carrito
        const cartToggle = document.getElementById('cart-toggle');
        const cartModal = document.getElementById('cart-modal');
        
        cartToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            cartModal.classList.toggle('hidden');
        });
        
        // Cerrar modal al hacer clic fuera
        document.addEventListener('click', () => {
            cartModal.classList.add('hidden');
        });
        
        // Evitar que el clic en el modal lo cierre
        cartModal.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        
        // Botón de finalizar compra
        document.getElementById('checkout-btn')?.addEventListener('click', () => {
            alert('Compra mayorista finalizada!\nTotal: ' + document.getElementById('cart-total').textContent);
            carrito.items = [];
            carrito.actualizarUI();
            carrito.guardarEnLocalStorage();
        });
    });
</script>

</body>
</html>


